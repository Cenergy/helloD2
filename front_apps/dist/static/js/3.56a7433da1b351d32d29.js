webpackJsonp([3],{"99RW":function(e,t,s){e.exports=s.p+"static/img/title.449dec2.png"},GTho:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={data:function(){return{message:"",messageShow:!1,isShow:!1,inputValue:"",stream:null,faceTime:0}},methods:{getUserMediaToPhoto:function(e,t,s){navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(e).then(t).catch(s):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(e,t,s):navigator.mozGetUserMedia?navigator.mozGetUserMedia(e,t,s):navigator.getUserMedia&&navigator.getUserMedia(e,t,s)},success:function(e){this.stream=e;var t=this.$refs.video;try{t.srcObject=e}catch(a){var s=window.URL||window.webkitURL;t.src=s.createObjectURL(e)}this.$refs.video.play()},error:function(e){console.log("访问用户媒体失败：",e.name,e.message)},getPhtot:function(){(navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia)&&this.getUserMediaToPhoto({video:{width:640,height:640}},this.success,this.error)},getBase64:function(){var e=this.$refs.video,t=this.$refs.canvas;return t.getContext("2d").drawImage(e,0,0,640,480),t.toDataURL("image/png")},begin:function(){var e=this;if(this.message="正在识别,请稍后...",this.messageShow=!0,this.isShow){if(""===this.inputValue)return void(this.message="请您先填写用户名");var t=this.getBase64();this.$axios({method:"post",url:"/user/register/",data:this.$qs.stringify({face_str:t,face_name:this.inputValue})}).then(function(t){console.log(t),200===t.status&&200===t.data.code?e.$router.push("/userManage"):e.faceTime<10?(e.faceTime++,e.message=t.data.message,setTimeout(function(){e.begin()},1500)):(e.message=t.data.message,e.faceTime=0)})}else{var s=this.getBase64();this.$axios({method:"post",url:"/user/login/",data:this.$qs.stringify({face_str:s})}).then(function(t){console.log(t),200===t.status&&200===t.data.code?(e.$cookies.set("Authorization",t.data.Authorization),e.$cookies.set("username",t.data.username),e.$router.push("/menu")):e.faceTime<10?(e.faceTime++,e.message=t.data.message,setTimeout(function(){e.begin()},1500)):(e.message=t.data.message,e.faceTime=0)})}},isLogin:function(){this.$route.query.form?this.isShow=!0:this.isShow=!1}},mounted:function(){this.getPhtot(),this.isLogin()},beforeRouteLeave:function(e,t,s){this.stream.getTracks()[0].stop(),s()}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"login"},[e.isShow?a("header-tab"):e._e(),e._v(" "),a("img",{staticClass:"title",attrs:{src:s("99RW"),alt:""}}),e._v(" "),a("div",{staticClass:"face"},[a("div",{staticClass:"content"},[a("video",{ref:"video",attrs:{id:"video",autoplay:""}}),e._v(" "),a("canvas",{ref:"canvas",attrs:{id:"canvas",width:"640",height:"480"}})]),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:e.messageShow,expression:"messageShow"}],staticClass:"message"},[e._v(e._s(e.message))])]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.inputValue,expression:"inputValue"},{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],staticClass:"name",attrs:{type:"text",placeholder:"请填写用户名"},domProps:{value:e.inputValue},on:{input:function(t){t.target.composing||(e.inputValue=t.target.value)}}}),e._v(" "),a("div",{staticClass:"begin",class:{bottom:!e.isShow},on:{click:e.begin}},[a("p",{staticClass:"text"},[e._v("开始识别")])])],1)},staticRenderFns:[]};var o=s("VU/8")(a,i,!1,function(e){s("RT5+")},"data-v-89cddc00",null);t.default=o.exports},"RT5+":function(e,t){}});
//# sourceMappingURL=3.56a7433da1b351d32d29.js.map